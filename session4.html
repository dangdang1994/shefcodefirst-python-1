<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Facebook Open Graph tags -->
    <meta property="og:url" content="https://darrenvong.github.io/shefcodefirst-python/session4.html">
    <meta property="og:title" content="Session 4: Flask - using Python & HTML together (Part 2)">
    <meta property="og:description" content="Linking together the back-end with the front-end">
    <meta property="og:image" content="https://darrenvong.github.io/shefcodefirst-python/assets/session4_slide.png">

    <title>CFG session 4</title>

    <link rel="stylesheet" href="reveal.js/css/reveal.css">
    <link rel="stylesheet" href="reveal.js/css/theme/white.css">
    <!-- or you can use the dark theme
    rel="stylesheet" href="reveal.js/css/theme/black.css"> -->

    <!-- Customised theme  -->
    <link rel="stylesheet" href="reveal.js/css/theme/custom.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="reveal.js/lib/css/github-gist.css">

    <!-- Font awesome -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css" rel="stylesheet" media="all">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!-- Session specific CSS -->
    <link rel="stylesheet" href="css/session4.css">

  </head>
  <body>
    <div class="reveal">
      <div class="slides logo">
        <section>
          <h2> Session 4: Flask - using Python & HTML
            <span style="margin-left: 10px">together</span> (Part 2)
          </h2>
          <p>Linking together the back-end with the front-end</p>
          <p class='author'> Darren Vong
          <br>
         <a href="http://twitter.com/mrdarrenv" target="_blank">
          <i class="fa fa-twitter" aria-hidden="true">
          </i> @mrdarrenv
         </a>
            </p>
        </section>

        <section>
          <h2> Where can I find the material? </h2>
          You can find all the slides, links to the curriculum, and
          to the GitHub repository at:
          <br>
          <br>
          <p class='fragment grow'>
            <a href="https://darrenvong.github.io/shefcodefirst-python/">
              https://darrenvong.github.io/shefcodefirst-python/</a></p>
        </section>

        
        <section>
          <h3> <i class="fa fa-reply" aria-hidden="true"></i>
            Recap: What happens when we visit a web page?
          </h3>
          <figure style="position: relative;">
            <img src="assets/req_res_cycle.png" alt="The Request-Response Cycle">
            <strong>
              <p id="req-url">https://pawlean.com</p>
            </strong>
            <div id="res">
              <strong>
                <p style="margin:0;">&lt;!DOCTYPE html&gt;</p>
              </strong>
              <strong>
                <p style="margin:0;">&lt;html&gt;...&lt;/html&gt;</p>
              </strong>
            </div>
          </figure>
        </section>

        <section>
          <ul>
            <li>
              Typing in the URL of the page sends <strong>a request</strong> to the server
              running the website.
            </li>
            <li>
              Using the information in the request with the URL, the server generates the
              right HTML page as <strong>a response</strong> back to our browser.
            </li>
            <li>
              Our browser processes the HTML response, along with any included CSS and
              JavaScript, then renders it out nicely for us to see in our browser.
            </li>
          </ul>
        </section>

        <section>
          <h3><i class="fa fa-reply" aria-hidden="true"></i>
            Recap: Flask <i class="fa fa-flask" aria-hidden="true"></i>
          </h3>
          <ul>
            <li>
              A <strong>framework</strong> which handles the complexity of
              <strong>requests</strong> & <strong>responses</strong>
            </li>
            <li class="fragment">
              This allows us to focus on the more <strong>fun stuff</strong> like
              designing and writing our application.
            </li>
          </ul>
        </section>
        
        <section>
          <ul>
            <li>
              Recall from the last session that Flask uses templates, and they are run
              through a template engine to generate the full HTML page <strong>dynamically</strong>.
            </li>
            <li class="fragment">
              The full HTML page are then returned as a response back to our browser.
            </li>
          </ul>
        </section>
        
        <section>
          <h3>
            <i class="fa fa-reply" aria-hidden="true"></i>
            Recap: Routing
          </h3>
          <p>
            The <strong>app.route(...)</strong> part <strong>binds</strong>
            the URL pattern specified to the standard Python
            function which will then handle the <strong>requests</strong> from users.
          </p>
          <p class="fragment">
            Flask uses <strong>relative URLs</strong> - this is usually the string after the
            <strong>first single slash</strong>.
          </p>
        </section>

        <section>
          <h3>
            <i class="fa fa-reply" aria-hidden="true"></i>
            Recap: Routing (cont.)
          </h3>
          <p>
            Relative URLs are used so that our application <strong>works in a consistent way</strong>,
            regardless of where we host it.
          </p>
          <p class="fragment">
            In our case where we have been developing locally, <strong>/hello</strong> is
            a relative URL with respect to the host <strong>localhost:5000</strong>, and so
            can be accessed by visiting <strong>localhost:5000/hello</strong>
          </p>
        </section>

        <section>
          <h3>And now...</h3>
        </section>

        <section>
          <h3><i class="fa fa-lightbulb-o" aria-hidden="true"></i>
            What is a template engine? Why do we use it?
          </h3>
          <ul>
            <li>
              A template engine is a tool which allows us to write our HTML pages in
              smaller, re-usable parts called <strong>templates</strong>.
            </li>
            <li class="fragment">
              To understand why we use a template engine, we need to take a quick look
              at how web pages were made <strong>before template engines existed</strong>.
            </li>
          </ul>
        </section>

        <section>
          <p>
            Without templates, web pages have to be served as <strong>static HTML files</strong>
            when the user visits the page. These have to be written up <strong>in full</strong>
            before a user visit our site.
          </p>
          <p class="fragment">
            This is essentially what you did if you completed the Beginners course!
          </p>
        </section>

        <section>
          <h3>
            Problems with static HTML <span style="margin-left:10px;">pages</span>...
          </h3>
          <ul>
            <li>
              Re-writing (or lots of copy and pasting) common HTML parts each time we make
              a new page gets <strong>tedious</strong>
            </li>
            <li class="fragment">Repetition of code is (generally) a bad idea.</li>
          </ul>
        </section>

        <section>
          <h3>
            Problems with static HTML <span style="margin-left:10px;">pages</span>... (cont.)
          </h3>
          <ul id="static-problem-list">
            <li>
              Static pages can't be adapted (easily) to cases where the content is different
              depending on, say, the user visiting the page.
            </li>
            <li class="fragment">
              This is what we'd referred to as <strong>dynamic pages</strong>, where we only know
              how to lay out & style the page but not all contents up front.
            </li>
            <li class="fragment">
              Facebook and Twitter are great examples: the feed is different for everyone visiting, as it
              depends on <strong>many variable factors</strong> such as who they follow/are friends with etc.
            </li>
          </ul>
        </section>
        
        <section>
          <h3>Solution: write and use HTML <span style="margin-left:10px;">templates!</span></h3>
        </section>
        
        <section>
          <h3>How do templates solve our problems?</h3>
          <p>
            When writing templates, we only need to write in the HTML parts that
            <strong>we know for definite</strong>.
          </p>
          <p class="fragment">
            For parts we don't know, the HTML is generated with some logics using
            Python-like code with data from a user's <strong>request</strong> when they
            visit our website.
          </p>
          <p class="fragment">Let's see how we can do this in <strong>Flask</strong>!</p>
        </section>

        <section>
          <h3>
            <i class="fa fa-cogs" aria-hidden="true"></i>
            Hands on: a Flask program using templates
          </h3>
        </section>

        <section>
          <p>
            In <strong>templates/index.html</strong>, add the following HTML above
            "Hello world!" so the <code>body</code> should look as follows:
          </p>
          <div data-markdown>
            ```html
            &lt;body&gt;
              &lt;nav&gt;
                &lt;ul&gt;
                  &lt;li>Home&lt;/li&gt;
                  &lt;li>About&lt;/li&gt;
                  &lt;li>Contact&lt;/li&gt;
                &lt;/ul&gt;
              &lt;/nav&gt;
            
              &lt;h1>Hello world!&lt;/h1&gt;
            &lt;/body&gt;
            ```
          </div>
        </section>

        <section>
          <p>Next, add in the following at the end of <strong>assets/app.css</strong>:</p>
          <div data-markdown>
            ```css
            nav ul {
              list-style: none;
              font-family: Arial, sans-serif;
              font-size: 20px;
              text-align: center;
            }

            nav ul li {
              display: inline;
              margin-right: 20px;
            }
            ```
          </div>
        </section>

        <section>
          <p>
            The bits of HTML and CSS we just added in give the page a <strong>navigation bar</strong>.
          </p>
          <p class="fragment">
            This is so we have some visual feedback that our page still works
            when we <strong>break up</strong> our HTML later (more in a moment!)
          </p>
        </section>

        <section>
          <h3>A multi-page app</h3>
          <p>
            So far, our app only has a single page. What if we want to add an <strong>About</strong>
            page as mentioned on our (fictional) navigation bar?
          </p>
          <p class="fragment">
            In the beginners course, it's likely that you'd make a <strong>new HTML file</strong>,
            copy & paste what you had in <strong>index.html</strong> and adapt.
          </p>
          <p class="fragment">
            But as mentioned earlier, this is <strong>tedious</strong> & <strong>error prone</strong>.
          </p>
        </section>

        <section>
          <p>
            For example, you might forget to update a link on the nav bar <strong>across all pages</strong>
            when you update the name of a file.
          </p>
          <p class="fragment">
            We can avoid this problem if we <strong>break up</strong> our HTML templates!
          </p>
          <p class="fragment">
            Common parts like <strong>nav bars</strong> at the top and <strong>footer</strong>
            at the bottom of our HTML provide good breaking points.
          </p>
        </section>

        <section>
          <h3>
            <i class="fa fa-cogs" aria-hidden="true"></i>
            Hands on: Breaking up our HTML templates
          </h3>
        </section>

        <section>
          <p>
            In the <strong>templates</strong> folder, create a new HTML file called
            <strong>header.html</strong>. Then, cut out the following from <strong>index.html</strong>
            and put it in <strong>header.html</strong>:
          </p>
          <div data-markdown>
            ```html
            &lt;!DOCTYPE html&gt;
            &lt;html lang="en"&gt;
            
            &lt;head&gt;
              &lt;meta charset="UTF-8"&gt;
              &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
              &lt;meta http-equiv="X-UA-Compatible" content="ie=edge"&gt;
              &lt;title>First Flask app&lt;/title&gt;
              &lt;link rel="stylesheet" href="{{ url_for('static', filename='app.css') }}"&gt;
            &lt;/head&gt;
            
            &lt;body&gt;
              &lt;nav&gt;
                &lt;ul&gt;
                  &lt;li>Home&lt;/li&gt;
                  &lt;li>About&lt;/li&gt;
                  &lt;li>Contact&lt;/li&gt;
                &lt;/ul&gt;
              &lt;/nav&gt;
            ```
          </div>
        </section>

        <section>
          <p>
            Since we just cut out the header HTML from <strong>templates/index.html</strong>,
            we need to <strong>include </strong>it back right where we removed it so our page
            will still display correctly: 
          </p>
          <div data-markdown>
            ```django
            {% include "header.html" %}
            ```
          </div>
          <p>
            Save that and browse to <code>localhost:5000</code>. If you've done this right,
            you should see <strong>exactly the same page</strong> as before!
          </p>
          <hr>
          <small>
            We don't have a footer in this simple example. But if we do, we'd repeat the same
            process for the footer and include it at the bottom of <strong>index.html</strong>.
          </small>
        </section>

        <!-- TO-DO: PUT THIS SECTION BEFORE syntax stuff:
          Passing data from Python to template for use (mainly outputting it) -->
        <!-- TO-DO: Bonus ex 1: Create the additional pages and correctly link them up -->
        <!-- TO-DO: Bonus ex 2: Create separate pages such that there's a student page where
        only students are printed out. -->
        <!-- TO-DO: Bonus ex 3: Include fixed JSON weather data that can be read in and outputted
        depending on page visited by user. Nice precursor to APIs! -->

        <section>
          <h3>Delving further into templates</h3>
          <p>
            Flask uses a template engine (Jinja2) to build up the <strong>response HTML</strong>.
          </p>
          <p class="fragment">
            Jinja2 extends the power of normal HTML by allowing us to include logic writing
            <strong>Python-like</strong> code.
          </p>
          <p class="fragment">
            This is super handy for cases where you have some data that will be laid out using
            <strong>the same</strong> HTML markup (e.g. items in a list).
          </p>
        </section>

        <section id="jinja2-syntax">
          <h3><i class="fa fa-code"></i>
            Templates syntax: the basics
          </h3>
          <p>
            To include any Python statements (<strong>if</strong>, <strong>for loops</strong> etc),
            enclose it with a pair of <code>{%  %}</code> as follows:
          </p>
          <div data-markdown>
            ```django
            {% if age > 18 %}
              &lt;p&gt;Maybe you can drink!&lt;/p&gt;
            {% else %}
              &lt;p&gt;Naughty! You're too young to drink!&lt;/p&gt;
            {% endif %}
            ```
          </div>
          <p class="fragment">
            Note that we have to put <code>endif</code> to mark the end of an if-statement,
            since indentation is <strong>not</strong> taken into account.
          </p>
        </section>

        <section>
          <h3><i class="fa fa-code"></i>
            Templates syntax: the basics
          </h3>
          <p>
            To <strong>output</strong> the value (most likely be a string or some number) of a variable,
            enclose it with a pair of <code>{{ }}</code> as shown below:
          </p>
          <div data-markdown>
            ```django
            &lt;h2&gt;{{ name }}&lt;/h2&gt;

            &lt;!-- If name has the value "Darren", the above
            will be converted to the following by Jinja2: --&gt;
            &lt;h2&gt;Darren&lt;/h2&gt;
            ```
          </div>
        </section>

        <section>
          <p>
            Outputting value is not limited to variables only. You can also output
            the result of function calls or data access expression from a list like so:
          </p>
          <div data-markdown>
            ```django
            &lt;!-- "DARREN" will end up between the &lt;h2&gt; when
            converted by Jinja2 --&gt;
            &lt;h2&gt;{{ name.upper() }}&lt;/h2&gt;

            &lt;!-- Assume shopping_list = ["apple", "pear"],
            then "apple" will end up between the &lt;p&gt;
            when converted by Jinja2 --&gt;
            &lt;p&gt;{{ shopping_list[0] }}&lt;/p&gt;
            ```
          </div>
        </section>

        <section>
          <h3>Templates: functions from Flask</h3>
          <p>
            Certain functions are also made available by Flask in templates.
          </p>
          <p class="fragment">
            The <strong>most useful</strong> one you should know about is <code>url_for</code>!
          </p>
          <p class="fragment">
            This is the function we used earlier to include our CSS files earlier!
          </p>
        </section>

        <section id="url_for">
          <p>
            The <code>url_for()</code> function returns a string containing the full URL
            to assets (CSS, JavaScript, images etc) in the <strong>static</strong> folder when called
            with <code>url_for("static", ...)</code>
          </p>
          <p>Hence, it's commonly used to pull in assets as follows:</p>
          <div data-markdown>
            ```django
            &lt;!-- Examples on how to pull in CSS, JS and
            images with url_for --&gt;
            &lt;link rel="stylesheet" href="{{ url_for('static', filename='app.css') }}"&gt;
            &lt;script src="{{ url_for('static', filename='app.js')}}"&gt;&lt;/script&gt;
            &lt;img src="{{ url_for('static', filename='img/pauline.jpg') }}" alt="Pauline"&gt;
            ```
          </div>
          <small>
            <hr>
            If you want a more comprehensive template reference, visit the official docs
            <a href="http://jinja.pocoo.org/docs/2.10/templates/">here</a>!
          </small>
        </section>

        <section>
          <h3>More about requests...</h3>
          <p>
            Hopefully by now, you'd have noticed that the word <strong>request</strong>
            has been mentioned repeatedly.
          </p>
          <p class="fragment">
            There's just <strong>one more</strong> little detail that we need to
            understand about <strong>requests</strong> before we can move forward... the
            <strong>request type</strong>!
          </p>
        </section>

        <section>
          <h3>More about requests...</h3>
          <p>Earlier, we said:</p>
          <p class="fragment">
            "Typing in the URL of the page sends <strong>a request</strong> to the server
            running the website."
          </p>
          <p class="fragment">
            In fact, to be more precise, we are actually sending a <strong>GET request</strong>
            to the server running the website.
          </p>
        </section>

        <section>
          <h3>The main problem with GET requests</h3>
          <p>
            If we want the user to send some extra data when they visit a page on our website,
            the data are visible at the end of the URL.
            This is all well and good <strong>if the data is not sensitive</strong>!
          </p>
          <p class="fragment">
            To solve this problem, browsers allows data to be sent using a different kind of request
            known as a <strong>POST request</strong>, which is only accessible on our server.
          </p>
        </section>

        <section>
          <h3>
            <i class="fa fa-cogs" aria-hidden="true"></i>
            Hands on: handling POST requests in our Flask program
          </h3>
        </section>

        <!-- TO-DO: Code snippets on creating a form in HTML -->
        <!-- TO-DO: Modifying @app.route(...) so it can handle POST requests -->
        
        <section>
          <h2>The end!</h2>
        </section>

      </div>
    </div>

    <script src="reveal.js/lib/js/head.min.js"></script>
    <script src="reveal.js/js/reveal.js"></script>

    <script>
      // More info about config & dependencies:
      // - https://github.com/hakimel/reveal.js#configuration
      // - https://github.com/hakimel/reveal.js#dependencies
      Reveal.initialize({
        dependencies: [
          { src: 'reveal.js/plugin/markdown/marked.js' },
          { src: 'reveal.js/plugin/markdown/markdown.js' },
          { src: 'reveal.js/plugin/notes/notes.js', async: true },
          { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
        ]
      });
    </script>
  </body>
</html>
